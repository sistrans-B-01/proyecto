SELECT SEL1.IDCLIENTE, SEL1.TIPOIDCLIENTE, CLI.NOMBRE, CLI.TIPOCLIENTE
FROM(
SELECT IDCLIENTE, TIPOIDCLIENTE, COUNT(IDCLIENTE)
FROM RESERVA
GROUP BY IDCLIENTE, TIPOIDCLIENTE, IDOFERTA
HAVING COUNT(IDCLIENTE)>=3)SEL1,
(SELECT IDCLIENTE, TIPOIDCLIENTE
FROM RESERVA
WHERE FECHAIDA-FECHALLEGADA <= 15) SEL2, CLIENTE CLI
WHERE SEL1.IDCLIENTE = SEL2.IDCLIENTE
AND SEL1.TIPOIDCLIENTE = SEL2.TIPOIDCLIENTE
AND SEL1.IDCLIENTE = CLI.NUMEROIDENTIFICACION
AND SEL1.TIPOIDCLIENTE= CLI.TIPOIDENTIFICACION
GROUP BY SEL1.IDCLIENTE, SEL1.TIPOIDCLIENTE, CLI.NOMBRE, CLI.TIPOCLIENTE;

--preparacion
 INSERT INTO ClIENTE
(NOMBRE, NUMEROIDENTIFICACION,TIPOIDENTIFICACION,TIPOCLIENTE)
VALUES
('JUAN ORJUELA', 31641, 'CC', 'PROFESOR');
INSERT INTO ClIENTE
(NOMBRE, NUMEROIDENTIFICACION,TIPOIDENTIFICACION,TIPOCLIENTE)
VALUES
('JOSE ALBARADO', 31642, 'CC', 'EMPLEADO');
INSERT INTO ClIENTE
(NOMBRE, NUMEROIDENTIFICACION,TIPOIDENTIFICACION,TIPOCLIENTE)
VALUES
('ALBERTO CAMARGO', 31643, 'CC', 'ESTUDIANTE');


INSERT INTO VECINOS
(NOMBRE, NUMEROIDENTIFICACION, TIPOIDENTIFICACION)
VALUES
('HUMBERTO RODRIGUEZ', 31644, 'CC');

INSERT INTO VIVIENDA
(CARACTERISTICASSEGURO, MENAJE,NUMERODIASUSADA,NUMEROHABITACIONES,SERVICIOS,UBICACION,IDVECINO,TIPOIDENTIFICACION)
VALUES
('todo riesgo', '1-Closet, 2-cama, 3-sofa', 1, 2, 'LUZ','CALLE 4 # 1-3 TORRE 15 APTO 203', 31644, 'CC');

INSERT INTO OFERTA
(ID, DESCUENTO,DIASACTIVA,DIASUSADA,FECHAFIN,FECHAINICIO,TIEMPOCONTRATO)
VALUES
(31650, 0, 0,0, '20-MAR-2020', '19-MAR-2020', 'UNA SEMANA');

INSERT INTO OFERTAVIVIENDA
(IDOFERTA, IDVIVIENDA)
VALUES
(31650, 'CALLE 4 # 1-3 TORRE 15 APTO 203');

--RESERVAS CLIENTE 1
INSERT INTO RESERVA
(ID, COSTOPAGADO, COSTOTOTAL, FECHAIDA, FECHALLEGADA, FECHADEPAGO, TIEMPOALOJAMIENTO, IDCLIENTE, TIPOIDCLIENTE, IDOFERTA)
VALUES
(31651, 150000, 170000, '20-ENE-2020','19-ENE-2020', '20-ENE-2020', '1 DIAS', 31641, 'CC', 31650);
INSERT INTO RESERVA
(ID, COSTOPAGADO, COSTOTOTAL, FECHAIDA, FECHALLEGADA, FECHADEPAGO, TIEMPOALOJAMIENTO, IDCLIENTE, TIPOIDCLIENTE, IDOFERTA)
VALUES
(31652, 150000, 170000, '20-ENE-20','19-ENE-20', '20-ENE-20', '1 DIAS', 31641, 'CC', 31650);
INSERT INTO RESERVA
(ID, COSTOPAGADO, COSTOTOTAL, FECHAIDA, FECHALLEGADA, FECHADEPAGO, TIEMPOALOJAMIENTO, IDCLIENTE, TIPOIDCLIENTE, IDOFERTA)
VALUES
(31653, 150000, 170000, '25-ENE-20','23-ENE-20', '25-ENE-20', '2 DIAS', 31641, 'CC', 31650);


--RESERVAS CLIENTE 2
INSERT INTO RESERVA
(ID, COSTOPAGADO, COSTOTOTAL, FECHAIDA, FECHALLEGADA, FECHADEPAGO, TIEMPOALOJAMIENTO, IDCLIENTE, TIPOIDCLIENTE, IDOFERTA)
VALUES
(31654, 150000, 170000, '29-ENE-20','28-ENE-20', '29-ENE-20', '1 DIA', 31642, 'CC', 31650);
INSERT INTO RESERVA
(ID, COSTOPAGADO, COSTOTOTAL, FECHAIDA, FECHALLEGADA, FECHADEPAGO, TIEMPOALOJAMIENTO, IDCLIENTE, TIPOIDCLIENTE, IDOFERTA)
VALUES
(31655, 150000, 170000, '02-FEB-20','01-FEB-20', '02-FEB-20', '1 DIA', 31642, 'CC', 31650);
INSERT INTO RESERVA
(ID, COSTOPAGADO, COSTOTOTAL, FECHAIDA, FECHALLEGADA, FECHADEPAGO, TIEMPOALOJAMIENTO, IDCLIENTE, TIPOIDCLIENTE, IDOFERTA)
VALUES
(31656, 150000, 170000, '10-FEB-20','05-FEB-20', '10-FEB-20', '5 DIAS', 31642, 'CC', 31650);

INSERT INTO RESERVA
(ID, COSTOPAGADO, COSTOTOTAL, FECHAIDA, FECHALLEGADA, FECHADEPAGO, TIEMPOALOJAMIENTO, IDCLIENTE, TIPOIDCLIENTE, IDOFERTA)
VALUES
(31657, 150000, 170000, '20-FEB-20','12-FEB-20', '20-FEB-20', '8 DIAS', 31642, 'CC', 31650);

--RESERVAS CLIENTE 3
INSERT INTO RESERVA
(ID, COSTOPAGADO, COSTOTOTAL, FECHAIDA, FECHALLEGADA, FECHADEPAGO, TIEMPOALOJAMIENTO, IDCLIENTE, TIPOIDCLIENTE, IDOFERTA)
VALUES
(31658, 150000, 170000, '29-MAR-20','28-MAR-20', '29-MAR-20', '1 DIA', 31642, 'CC', 31650);
INSERT INTO RESERVA
(ID, COSTOPAGADO, COSTOTOTAL, FECHAIDA, FECHALLEGADA, FECHADEPAGO, TIEMPOALOJAMIENTO, IDCLIENTE, TIPOIDCLIENTE, IDOFERTA)
VALUES
(31659, 150000, 170000, '02-MAR-20','01-MAR-20', '02-MAR-20', '1 DIA', 31642, 'CC', 31650);

COMMIT;